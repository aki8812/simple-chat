/* 版面與主色系 */
:root { --bg:#2c2f33; --bg2:#23272a; --panel:#36393f; --brand:#5865f2; --brand2:#4f545c; --text:#fff; --muted:#ccc; }
*{box-sizing:border-box}
html,body{height:100%; overflow:hidden} /* 固定視窗，不讓整站上下捲 */
body { margin:0; background-color:var(--bg); font-family:'Segoe UI', "Microsoft JhengHei", sans-serif; color:var(--text); }

.app { display:grid; grid-template-columns:240px 1fr; height:100vh; }
@supports (height: 100dvh) {
  .app{ height:100dvh; }
}

.sidebar {
  background:var(--bg2);
  border-right:1px solid #1f2225;
  display: flex;
  flex-direction: column;
  height: 100%;
}
.sidebar-content {
  padding:12px 12px 0 12px;
  overflow-y: auto;
  flex: 1;
}
.sidebar .brand { font-weight:700; margin-bottom:8px; opacity:.9; cursor:pointer; user-select:none; }
.userrow{padding:6px 8px; border-radius:6px; cursor:pointer}
.userrow:hover{background:#2b2f33}
.userrow.me{ color:#66b3ff !important; font-weight:700; } /* 自己：藍色（即使被封也優先藍色） */
.userrow.admin{ color:#ffd54a; font-weight:700; }        /* 管理員：亮黃 */
.userrow.banned{ color:#b71c1c; }                        /* 被封：深紅 */
.tag-admin{ font-size:12px; opacity:.9; margin-left:4px; }

#adminPanel {
  padding: 12px;
  border-top: 1px solid #1f2225;
}
#manageBtn {
  width: 100%;
  background-color: var(--brand2);
  text-align: center;
}
#manageBtn:hover {
  background-color: #6a707a;
}

.main { display:grid; grid-template-rows:auto 1fr auto; height:100vh; }
@supports (height: 100dvh) {
  .main{ height:100dvh; }
}
.topbar { display:flex; justify-content:space-between; align-items:center; padding:10px; border-bottom:1px solid #1f2225; background:var(--bg2); gap:8px; }
.topbar .right{display:flex; gap:6px; align-items:center}
.topbar input{background:#1e2124; border:1px solid #444; color:#fff; padding:6px 8px; border-radius:6px}
button{background:#7289da; color:#fff; border:none; padding:8px 10px; border-radius:6px; cursor:pointer}
button:hover{background:#5b6eae}
button.danger{background:#e02e2e}
button.danger:hover{background:#c22626}
.linklike{background:transparent; text-decoration:underline; cursor:pointer}

.banner{background:#3a3f45; border-left:4px solid #ffcc00; padding:6px 8px; border-radius:6px}
.hidden{display:none}

.chat-box { overflow-y:auto; padding:16px; display:flex; flex-direction:column; gap:10px; background:var(--bg); }
.input-area {
  display:flex; gap:6px; padding:10px; border-top:1px solid #1f2225; background:var(--bg2);
  position:sticky; bottom:0; z-index:5;
  padding-bottom:calc(env(safe-area-inset-bottom,0px) + 10px);
  align-items: flex-end; /* 確保輸入框和按鈕底部對齊 */
}
.input-area .input-main {
  flex: 1;
  display: flex;
  flex-direction: column;
}
.input-area .input-main input {
  border-radius: 0 0 6px 6px;
  background:#1e2124; border:1px solid #444; color:#fff; padding:10px;
  height: 42px;
}
/* 當沒有檔案預覽時，輸入框恢復圓角 */
.input-area .input-main input:only-child {
  border-radius: 6px;
}

#attachBtn, #sendBtn {
  flex-shrink: 0;
  width: 42px;
  height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
}
#attachBtn {
  font-size: 24px;
  background-color: var(--brand2);
  padding-bottom: 4px; /* 微調+號位置 */
}
#attachBtn:hover {
  background-color: #6a707a;
}
#attachBtn:disabled, #sendBtn:disabled {
  background-color: #333;
  cursor: not-allowed;
  opacity: 0.7;
}

.file-preview {
  background: #3a3f45;
  padding: 6px 12px;
  border-radius: 6px 6px 0 0;
  font-size: 14px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  color: var(--muted);
  border: 1px solid #444;
  border-bottom: none;
}
.file-preview .remove-file {
  cursor: pointer;
  font-weight: bold;
  padding: 0 4px;
  font-size: 20px;
}
.file-preview .remove-file:hover {
  color: var(--text);
}


/* 泡泡訊息 */
.chat-message { display:flex; align-items:flex-end; }
.chat-message.self{ flex-direction:row-reverse; }
.bubble { background:var(--brand); padding:10px 14px; border-radius:12px; max-width:70%; position:relative; }
.chat-message.other .bubble { background:var(--brand2); }

/* 當自己被提及時的訊息突顯樣式 */
.chat-message.mention-me .bubble {
  background-color: #4a412a;
  border: 1px solid #a48d4e;
}
.chat-message.mention-me.other .bubble::after {
  border-right-color: #4a412a;
}

.chat-message.self .bubble::after { content:""; position:absolute; right:-8px; top:12px; border:8px solid transparent; border-left-color:var(--brand); }
.chat-message.other .bubble::after { content:""; position:absolute; left:-8px; top:12px; border:8px solid transparent; border-right-color:var(--brand2); }
.bubble-head{display:flex; align-items:center; gap:6px; margin-bottom:6px}
.bubble-name{font-weight:700; opacity:.95; cursor:pointer}
.bubble-text{white-space:pre-wrap; word-break:break-word}
.bubble-time{font-size:12px; color:var(--muted); margin-top:6px; text-align:right}
.mention{color:#00aaff; font-weight:700}
.del-btn{background:#ff5555; padding:4px 8px; border-radius:6px; font-size:12px}

/* 檔案附件樣式 */
.bubble-text img.preview-img {
  max-width: 100%;
  max-height: 300px;
  border-radius: 8px;
  margin-top: 8px;
  cursor: pointer;
  background: #111;
}
.file-attachment {
  display: flex;
  align-items: center;
  gap: 10px;
  background-color: rgba(0,0,0,0.15);
  padding: 8px 12px;
  border-radius: 8px;
  margin-top: 8px;
  text-decoration: none;
  color: var(--text);
  border: 1px solid rgba(255,255,255,0.1);
}
.file-attachment:hover {
  background-color: rgba(0,0,0,0.25);
}
.file-attachment .icon {
  font-size: 28px;
  flex-shrink: 0;
}
.file-attachment .info {
  display: flex;
  flex-direction: column;
  overflow: hidden; /* 避免檔名過長溢出 */
}
.file-attachment .name {
  font-weight: bold;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.file-attachment .size {
  font-size: 12px;
  color: var(--muted);
}


/* 使用者卡片 */
.popup { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:var(--bg2); border-radius:10px; padding:18px; box-shadow:0 0 12px #000; z-index:1000; min-width:280px; border: 1px solid #1f2225; }

.user-card{ display: flex; flex-direction: column; gap: 12px;}
.card-name{ font-weight: bold; font-size: 18px; }
.card-registered{ font-size: 14px; color: var(--muted); }
.card-actions{ display: flex; justify-content: flex-end; gap: 8px; margin-top: 8px;}
.card-actions button.promote { background-color: #2d7d46; }
.card-actions button.promote:hover { background-color: #3a9d5a; }


/* 小螢幕：維持側欄存在，但高度用 100dvh，至少可打字 */
@media (max-width: 820px) {
  .app{ grid-template-columns: 240px 1fr; }
}

/* === Scrollbar Theme (Discord-like) === */
.sidebar-content::-webkit-scrollbar,
.chat-box::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}
.sidebar-content:hover::-webkit-scrollbar,
.chat-box:hover::-webkit-scrollbar {
  width: 12px;
  height: 12px;
}
.sidebar-content::-webkit-scrollbar-track,
.chat-box::-webkit-scrollbar-track {
  background: #1c1f22;
  border-radius: 10px;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.04);
}
.sidebar-content::-webkit-scrollbar-thumb,
.chat-box::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #3b4050, #2f3344);
  border-radius: 10px;
  border: 2px solid transparent;
  background-clip: padding-box;
}
.sidebar-content:hover::-webkit-scrollbar-thumb,
.chat-box:hover::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, #596080, #3a3f5a);
}
.sidebar-content::-webkit-scrollbar-thumb:active,
.chat-box::-webkit-scrollbar-thumb:active {
  background: linear-gradient(180deg, #6b73a0, #4a5180);
}
.sidebar-content::-webkit-scrollbar-corner,
.chat-box::-webkit-scrollbar-corner {
  background: #1c1f22;
}
.sidebar-content,
.chat-box {
  scrollbar-width: thin;
  scrollbar-color: #3b4050 #1c1f22;
}
.sidebar-content:hover,
.chat-box:hover {
  scrollbar-color: #596080 #1c1f22;
}
.chat-box {
  scrollbar-gutter: stable;
  overscroll-behavior: contain;
  scroll-behavior: smooth;
}